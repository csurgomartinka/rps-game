<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer K≈ë-Pap√≠r-Oll√≥</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="game-container">
    <header class="game-header">
  <div class="user-info">
    <span id="usernameDisplay"></span>
    <button id="logoutBtn" class="btn-logout">Kil√©p√©s</button>
    <button id="menuBtn" class="btn-menu">F≈ëmen√º</button>
  </div>
  <h1>K≈ë-Pap√≠r-Oll√≥</h1>
  <div class="room-info" id="roomInfo"></div>
</header>

    <main class="game-content">
      <!-- Kezd≈ëk√©perny≈ë -->
      <div class="start-screen" id="start">
        <div class="input-group">
          <input type="text" id="room" placeholder="Szoba neve" class="input-field">
          <button onclick="joinGame()" class="btn btn-primary">Csatlakoz√°s</button>
        </div>
      </div>

      <!-- J√°t√©k k√©perny≈ë -->
      <div class="game-screen" id="game" style="display:none;">
        <h2>V√°lassz!</h2>
        <div class="choices">
          <button onclick="sendChoice('k≈ë')" class="choice-btn rock-btn">
            <span class="icon">ü™®</span>
            <span>K≈ë</span>
          </button>
          <button onclick="sendChoice('pap√≠r')" class="choice-btn paper-btn">
            <span class="icon">üìÑ</span>
            <span>Pap√≠r</span>
          </button>
          <button onclick="sendChoice('oll√≥')" class="choice-btn scissors-btn">
            <span class="icon">‚úÇÔ∏è</span>
            <span>Oll√≥</span>
          </button>
        </div>
        <div class="timer-container">
          <div class="timer-bar" id="timerBar"></div>
          <p class="status-text" id="status">V√°rakoz√°s az ellenf√©lre...</p>
        </div>
      </div>

      <!-- Eredm√©ny k√©perny≈ë -->
      <div class="result-screen" id="result" style="display:none;">
        <div class="result-content">
          <h2>Eredm√©ny</h2>
          <p class="result-text" id="resultText"></p>
          <div class="scoreboard" id="scoreboard"></div>
          <div class="action-buttons">
            <button id="rematchBtn" class="btn btn-secondary">√öj j√°t√©k</button>
            <button id="exitBtn" class="btn btn-danger">Kil√©p√©s</button>
          </div>
        </div>
      </div>
    </main>

    <footer class="game-footer">
      <p>Multiplayer K≈ë-Pap√≠r-Oll√≥ J√°t√©k</p>
    </footer>
  </div>

  <script>
    // Itt marad a megl√©v≈ë JavaScript k√≥dod
    const socket = io();
    let roomId = '';
    let timeLeft = 30;
    let countdownInterval;

    const user = localStorage.getItem('user');
    if (!user) {
      window.location.href = 'login.html';
    }

    // Felhaszn√°l√≥ adatok bet√∂lt√©se
    document.addEventListener('DOMContentLoaded', function() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user && user.email) {
      document.getElementById('usernameDisplay').textContent = user.email;
    } else {
      window.location.href = 'login.html';
    }
  });

  // Kil√©p√©s gomb
  document.getElementById('logoutBtn').addEventListener('click', function() {
    localStorage.removeItem('user');
    window.location.href = 'login.html';
  });

  // F≈ëmen√º gomb
  document.getElementById('menuBtn').addEventListener('click', function() {
    window.location.href = 'menu.html';
  });

    function joinGame() {
      roomId = document.getElementById('room').value.trim();
      if (roomId) {
        socket.emit('joinGame', roomId);
        document.getElementById('start').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        document.getElementById('roomInfo').textContent = `Szoba: ${roomId}`;
      }
    }

    function sendChoice(choice) {
      socket.emit('choice', { roomId, choice });
      disableButtons();
      document.getElementById('status').textContent = `V√°lasztott√°l: ${choice}. V√°runk az ellenf√©lre...`;
    }

    function disableButtons() {
      document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);
    }

    function enableButtons() {
      document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = false);
    }

    function startCountdown() {
      timeLeft = 30;
      document.getElementById('timerBar').style.width = '100%';
      document.getElementById('status').textContent = `Id≈ë a v√°laszt√°sra: ${timeLeft} m√°sodperc`;
      countdownInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timerBar').style.width = `${(timeLeft / 30) * 100}%`;
        document.getElementById('status').textContent = `Id≈ë a v√°laszt√°sra: ${timeLeft} m√°sodperc`;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          disableButtons();
        }
      }, 1000);
    }

  socket.on('startGame', () => {
    document.getElementById('status').textContent = 'J√°t√©k indul!';
  });

  socket.on('new-round', () => {
    document.getElementById('result').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    enableButtons();
    startCountdown();
  });

  socket.on('result', (data) => {
    clearInterval(countdownInterval);
    document.getElementById('game').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    document.getElementById('resultText').textContent =
      `Te: ${data.yourChoice} | Ellenf√©l: ${data.opponentChoice} ‚Üí ${data.outcome}`;
    document.getElementById('scoreboard').textContent =
      `Pontsz√°m: Te ${data.yourScore} - ${data.opponentScore} Ellenf√©l`;
    document.getElementById('rematchBtn').disabled = true;
  });

  socket.on('game-over', () => {
    document.getElementById('rematchBtn').disabled = false;
    document.getElementById('status').textContent = 'A j√°t√©k v√©get √©rt.';
  });

  socket.on('rematch-start', () => {
    document.getElementById('result').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    enableButtons();
    startCountdown();
  });

  socket.on('opponent-left', () => {
    alert('Az ellenfeled kil√©pett üò¢');
    location.reload();
  });

  document.getElementById('rematchBtn').addEventListener('click', () => {
    socket.emit('play-again', roomId);
    document.getElementById('resultText').textContent = 'V√°rakoz√°s az ellenf√©lre...';
    document.getElementById('rematchBtn').disabled = true;
  });

  document.getElementById('exitBtn').addEventListener('click', () => {
    socket.emit('leave-room', roomId);
    location.reload();
  });
</script>

</body>
</html>
